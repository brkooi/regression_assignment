---
title: "Analysis Motor Trend"
author: "Ben Kooi"
date: "11-11-2021"
output: html_document
---
## Synopsis


## Configuring the environment for the analysis

Loading R-packages and configuring the environment..

```{r message=FALSE}
#laden van packages
packages <- c("dplyr","corrplot","ggplot2","tidyverse","stats","modelr","zoo","tsibble","car", "EnvStats")
sapply(packages, require, character.only=TRUE, quietly=TRUE)
knitr::opts_chunk$set(echo = TRUE)
```

## Read and clean the dataset 

In this section the dataset 'mtcars' is read from de library 'datasets'. 
The dataset is a dataframe with 32 different cars with 11 variables:   
*	mpg	 = Miles/(US) gallon;  
*	cyl	 = Number of cylinders;  
* disp =	Displacement (cu.in.);  
* hp   = Gross horsepower;  
* drat =	Rear axle ratio;  
* wt   =	Weight (1000 lbs);  
* qsec =	1/4 mile time;  
* vs	 = Engine (0 = V-shaped, 1 = straight);  
* am	 = Transmission (0 = automatic, 1 = manual);  
* gear = Number of forward gears;  
* carb = Number of carburetors;  

```{r prepare_data}
# read the mtcars-dataset
library(datasets)
data(mtcars)

# summary and structure of the cars-dataset
summary(mtcars)
str(mtcars)
```
The dataset seems to be clean and there are no NA's or NaN's.

## Analizing the dataset

First we make a density plot for the depending variable mpg to see if this variable is normal distributed.

```{r distribution, echo=FALSE}
plot(density(mtcars$mpg))
shapiro.test(mtcars$mpg)
```
The density-plot of mpg shows a distribution that seems normal, but not perfectly normal.
The shapiro-test confirms this with pvalue=0.1229 which is greater 0.05, but not extremely greater.
From this point of view we can use standard lineair regression for modelling the dependent variable mpg.

## Modeling the dataset

First we make generate a correlation-matrix of all variables in the dataset.

``` {r correlation}
cm<-cor(mtcars)
corrplot(cm, order = "AOE",method = "circle",addCoef.col = "gray" , insig = "p-value", title = "vTitleCmPlot")
```
Inspecting the correlation-matrix tells:
* a significant positive correlation of transmission (am) and miles per gallon (mpg). Overall a car with manual transmission gives you more miles per gallon;  
* weight (wt) has the strongest correlation with miles per gallon. The more a car weighs, the less miles per gallon.
* transmission (am) is negative correlated with weight (wt). Overall car with manual transmission weighs less than 
* there seems to be a lot of multicollinearity. 



# create multiple linear model
``` {r modelling}
mtcars$am <- as.factor(mtcars$am)
model1 <- lm(mpg ~ am, data=mtcars)
model2 <- lm(mpg ~ am + wt, data=mtcars)
model3 <- lm(mpg ~ wt + am + (wt * hp), data=mtcars)
model4 <- lm(mpg ~ ., data=mtcars)
          
summary(model1)
summary(model2)
summary(model3)
anova(model1,model2,model3)
shapiro.test(resid(model3))
mean(resid(model3))
res<-resid(model3)
round(sum(resid(model3)),5)
vif(model3)

#produce residual vs. fitted plot
plot(fitted(model3), res)

#add a horizontal line at 0 
abline(0,0)

#create Q-Q plot for residuals
qqnorm(res)

#add a straight diagonal line to the plot
qqline(res)

#Create density plot of residuals
plot(density(res))
```


Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
